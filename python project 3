import requests
from bs4 import BeautifulSoup
products_to_track = [
    {
        "product_url":"https://www.amazon.in/Samsung-Galaxy-Ocean-128GB-Storage/dp/B07HGGYWL6/ref=sr_1_1_sspa?dchild=1&keywords=samsung+m31&qid=1622534949&sr=8-1-spons&psc=1&spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEzNUtVV1pKNFNCNVJVJmVuY3J5cHRlZElkPUEwNTc2NDYwMktQQzFDTFE1STdIOSZlbmNyeXB0ZWRBZElkPUEwNTQ1MDgzM1YwWENGMUo3SUFKMyZ3aWRnZXROYW1lPXNwX2F0ZiZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=",
        "name":"Samsung M31 6gb 128gb",
        "target_price":10000
    },
    {
        "product_url":"https://www.amazon.in/Samsung-Galaxy-Raven-Black-Storage/dp/B07HGH8D2R/ref=sr_1_1_sspa?dchild=1&keywords=samsung+m21&qid=1622534919&sr=8-1-spons&psc=1&spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyUEgyMzhKU1ROUVJTJmVuY3J5cHRlZElkPUExMDE4OTI2MUJQUUI2N0NUVjdUTyZlbmNyeXB0ZWRBZElkPUEwMzU0MjE4WkNQNFJQVTFCTU1aJndpZGdldE5hbWU9c3BfYXRmJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==",
        "name":"Samsung M21 4gb 64gb",
        "target_price":13000
    },
    {
        "product_url":"https://www.amazon.in/Samsung-Galaxy-Storage-Additional-Exchange/dp/B086KCC68B/ref=sr_1_13?dchild=1&keywords=samsung+m21&qid=1622533297&sr=8-13",
        "name":"Samsung M11 4gb 64gb",
        "target_price":9000
    },
    {
        "product_url":"https://www.amazon.in/Samsung-Galaxy-Blue-32GB-Storage/dp/B08T2LYX5W/ref=sxin_2_hcs-la-in-1?cv_ct_cx=samsung+mobiles&dchild=1&keywords=samsung+mobiles&pd_rd_i=B08T2LYX5W&pd_rd_r=25dda26c-270b-4aeb-b02e-4f540e59f7cf&pd_rd_w=zg0Ue&pd_rd_wg=0lJzW&pf_rd_p=b6d118af-97d2-4a68-bf40-4cd2a7c6b3cd&pf_rd_r=YC9BMBWWDDFYHBHN1KZT&qid=1622540250&sr=1-4-99b054f1-0e42-4e3b-b375-028105b26bc6",
        "name":"Samsung M02 3gb 32gb",
        "target_price":8000
    },
    {
        "product_url":"https://www.amazon.in/Samsung-Galaxy-M12-Storage-Processor/dp/B08XJCMGL7/ref=sr_1_8?dchild=1&keywords=samsung+mobiles&qid=1622540518&s=electronics&sr=1-8",
        "name":"Samsung M12 4gb 64gb",
        "target_price":10000
    }


]
def give_product_price(URL):
    headers = {
        "user-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36 Edg/80.0.361.61"
    }
    page = requests.get(URL, headers=headers)
    soup = BeautifulSoup(page.content, 'html.parser')

    product_price = soup.find(id="priceblock_dealprice")
    if (product_price == None):
        product_price = soup.find(id="priceblock_ourprice")

    return product_price.getText()

result_file = open('my_result_file.txt','w')

try:
    for every_product in products_to_track:
        product_price_returned = give_product_price(every_product.get("product_url"))
        print(product_price_returned + " - " + every_product.get("name"))

        my_product_price = product_price_returned[2:]
        my_product_price = my_product_price.replace(',', '')
        my_product_price = int(float(my_product_price))

        print(my_product_price)

        if my_product_price < every_product.get("target_price"):
            print("Available at your price")
            result_file.write(every_product.get(
                "name") + ' _ \t' + 'Available at your target price' + 'current price -' + str(my_product_price) + '\n')


        else:
            print("still at current price")

finally:
    result_file.close()





